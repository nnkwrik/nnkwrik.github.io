---
title: å¹¶å‘æ“ä½œåˆé›†-1.çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ
tags:
  - Java
  - å¹¶å‘
  - å¹¶å‘åŸºæœ¬æ“ä½œåˆé›†
categories:
  - å¹¶å‘æ“ä½œåˆé›†
typora-copy-images-to: 20181030-2
date: 2018-11-01 21:52:09
---

> [ğŸ• å¹¶å‘æ“ä½œåˆé›†ç³»åˆ— æºä»£ç ](https://github.com/nnkwrik/learn-java-concurrency)

è¿™æ˜¯ä¸€ä¸ªå…³äºå¹¶å‘çš„ç³»åˆ—ã€‚ä»¥å®æˆ˜ä¸ºé©±åŠ¨ï¼Œäº†è§£å¹¶å‘ç¼–ç¨‹ä¸­çš„é‚£äº›éªšæ“ä½œã€‚æ–‡ä¸­çš„ç¤ºä¾‹ä»£ç éƒ½æ˜¯ä»ç½‘ä¸Šæ‰¾æ¥çš„ï¼Œå¦‚æœä½ å¯¹å¹¶å‘ç¼–ç¨‹è¿˜ä¸äº†è§£ï¼Œå¸Œæœ›ä½ èƒ½å’Œæˆ‘ä¸€æ ·æ•²ä¸€æ•²ç¤ºä¾‹ä¸­çš„ä»£ç ã€‚å¦‚æœä½ å¯¹å¹¶å‘æ“ä½œè¶³å¤Ÿç†Ÿæ‚‰ï¼Œä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªç³»åˆ—å½“åšä¸€æœ¬å·¥å…·ä¹¦ï¼Œæƒ³ä¸èµ·æ¥çš„æ—¶å€™æ¥çœ‹ä¸€çœ‹ï¼Œé¡ºä¾¿starä¸€ä¸‹GitHubä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

å¯¹äºå¹¶å‘ï¼Œæˆ‘ç›®å‰ä¹Ÿåœ¨æ‘¸ç´¢çš„è¿‡ç¨‹ä¸­ï¼Œå†™è¿™ä¸ªç³»åˆ—çš„ç›®çš„ä¸»è¦æ˜¯ä¸ºäº†å·©å›ºçŸ¥è¯†ã€‚å¦‚æœæœ‰ä¸å¯¹çš„åœ°æ–¹è¿˜æœ›æŒ‡æ­£ï¼

# çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ

ä¸‹å›¾æ˜¯Javaä¸­çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥åŠåˆ‡æ¢çŠ¶æ€çš„å¸¸ç”¨æ–¹æ³•ã€‚java.lang.Threadç±»åŒ…å«çš„çŠ¶æ€æšä¸¾å®šä¹‰äº†è¿™6ä¸ªçŠ¶æ€ã€‚

![1541035245337](20181030-2/1541035245337.png)

ä¸ç®¡åœ¨ä»»ä½•æ—¶å€™ï¼Œçº¿ç¨‹ä¼šæ˜¯ä»¥ä¸‹çŠ¶æ€çš„å…¶ä¸­ä¸€ä¸ªï¼š

- **New**ï¼ˆæ–°å»ºçŠ¶æ€)
  å½“çº¿ç¨‹å¯¹è±¡å¯¹åˆ›å»ºåï¼Œå³è¿›å…¥äº†æ–°å»ºçŠ¶æ€ï¼Œå¦‚ï¼šThread t = new MyThread();
- **Runnable**ï¼ˆå¯è¿è¡ŒçŠ¶æ€)
  å¯è¿è¡ŒçŠ¶æ€ä¸­åˆ†ä¸ºå°±ç»ªçŠ¶æ€å’Œè¿è¡ŒçŠ¶æ€ã€‚
  - å°±ç»ªï¼ˆReady to Runï¼‰
    å½“è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„start()æ–¹æ³•ï¼ˆt.start();ï¼‰ï¼Œçº¿ç¨‹å³è¿›å…¥å·²å°±ç»ªçš„çŠ¶æ€ã€‚å¤„äºæ­¤çŠ¶æ€çš„çº¿ç¨‹ï¼Œåªæ˜¯è¯´æ˜æ­¤çº¿ç¨‹å·²ç»åšå¥½äº†å‡†å¤‡ï¼Œéšæ—¶ç­‰å¾…CPUè°ƒåº¦æ‰§è¡Œï¼Œå¹¶ä¸æ˜¯è¯´æ‰§è¡Œäº†t.start()æ­¤çº¿ç¨‹ç«‹å³å°±ä¼šæ‰§è¡Œï¼›

  - è¿è¡Œï¼ˆRunningï¼‰
    å½“CPUå¼€å§‹è°ƒåº¦å¤„äºå°±ç»ªçš„çº¿ç¨‹æ—¶ï¼Œæ­¤æ—¶çº¿ç¨‹æ‰å¾—ä»¥çœŸæ­£æ‰§è¡Œï¼Œå³è¿›å…¥åˆ°æ­¤çŠ¶æ€ã€‚æ³¨æ„ï¼Œå°±ç»ªçŠ¶æ€æ˜¯è¿›å…¥åˆ°è¿è¡ŒçŠ¶æ€çš„å”¯ä¸€å…¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹è¦æƒ³è¿›å…¥è¿è¡ŒçŠ¶æ€æ‰§è¡Œï¼Œé¦–å…ˆå¿…é¡»å¤„äºå°±ç»ªçŠ¶æ€ä¸­ï¼›
- **Wating** / **Timed Wating**ï¼ˆç­‰å¾…çŠ¶æ€ / é™æ—¶ç­‰å¾…çŠ¶æ€ï¼‰
  ç­‰å¾…çŠ¶æ€åˆ†ä¸ºé‡Šæ”¾é”çš„ç­‰å¾…å’Œä¸é‡Šæ”¾é”çš„ç­‰å¾…ã€‚
  - é‡Šæ”¾é”
    è¿è¡ŒçŠ¶æ€ä¸­çš„çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•å’Œjoin()æ–¹æ³•ï¼Œä½¿çº¿ç¨‹è¿›å…¥åˆ°æ­¤çŠ¶æ€ã€‚è¿‡ç¨‹ä¼šé‡Šæ”¾é”
  - ä¸é‡Šæ”¾é”
     é€šè¿‡è°ƒç”¨çº¿ç¨‹çš„sleep()æ–¹æ³•ï¼Œä½¿çº¿ç¨‹è¿›å…¥åˆ°æ­¤çŠ¶æ€ã€‚è¿‡ç¨‹ä¸ä¼šé‡Šæ”¾é”ã€‚
- **Blocked**ï¼ˆé˜»å¡çŠ¶æ€ï¼‰
  é˜»å¡çŠ¶æ€æ˜¯æŒ‡åœ¨å¯¹è±¡çš„ç­‰å¾…é”å®šæ± ä¸­ï¼Œç­‰å¾…è¯¥å¯¹è±¡çš„é”æ—¶çš„çŠ¶æ€ã€‚å½“ä¸€ä¸ªå¯¹è±¡å°è¯•è®¿é—®synchronizedå—æ—¶ä¼šå¤„äºæ­¤çŠ¶æ€ã€‚
- **Terminated**ï¼ˆç»ˆæ­¢çŠ¶æ€ï¼‰
  çº¿ç¨‹æ‰§è¡Œå®Œäº†æˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†run()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚

ä¸‹é¢é€šè¿‡ä»£ç æ¥æ¨¡æ‹Ÿè¿™äº›çŠ¶æ€

## New

å¯ä»¥ç”¨start()æ–¹æ³•å»å¯åŠ¨ä¸€ä¸ªçŠ¶æ€ä¸ºNEWçš„çº¿ç¨‹

```java
Runnable runnable = new NewState();
Thread t = new Thread(runnable);
Log.info(t.getState());	//è¾“å‡º NEW
```

## Runnable

å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªçŠ¶æ€ä¸ºNEWçš„çº¿ç¨‹è°ƒç”¨start()æ–¹æ³•ï¼Œä»–å°±ä¼šå˜æˆRUNNABLEçŠ¶æ€ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸­ï¼Œè¿è¡Œä¸­æˆ–å·²ç»å¤„äºå·²åšå¥½å‡†å¤‡ï¼Œä¸€æ—¦è·å¾—èµ„æºå°±èƒ½è¿è¡Œã€‚

åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œçº¿ç¨‹è°ƒåº¦å™¨ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…å›ºå®šçš„æ—¶é—´ã€‚æ‰€ä»¥ä¸€ä¸ªå¤„äºRUNNABLEçŠ¶æ€çš„çº¿ç¨‹å¾ˆå¯èƒ½åªä¼šæŒç»­è¿è¡Œä¸€å°ä¼šï¼Œä¹‹åè°ƒåº¦å™¨ä¼šæŠŠèµ„æºåˆ†é…ç»™åˆ«çš„å¤„äºRUNNABLEçŠ¶æ€çš„çº¿ç¨‹ã€‚

```java
Runnable runnable = new NewState();
Thread t = new Thread(runnable);
t.start();
Log.info(t.getState());//è¾“å‡º RUNNABLEï¼Œä½†ä¹Ÿå¯èƒ½ä¸æ˜¯
```

ä¸Šé¢ç¨‹åºä¸­ï¼Œå¦‚æœåˆ›å»ºçš„çº¿ç¨‹tç«‹å³è¢«è°ƒåº¦å¹¶ä¸”è¿è¡Œç»“æŸï¼Œé‚£ä¹ˆt.getState()å°±ä¸ä¼šè¾“å‡ºRUNNABLEè€Œæ˜¯TERMINATEDã€‚

## Blocked

å½“ä¸€ä¸ªçº¿ç¨‹å¤„äºBLOCKEDçŠ¶æ€æ—¶ï¼Œè¡¨ç¤ºä»–å½“å‰æ²¡æœ‰é”æ‰€ä»¥æ— æ³•æ‰§è¡Œéœ€è¦åŒæ­¥çš„ä»£ç å—ã€‚è¿™ä¸ªçŠ¶æ€ä¼šæŒç»­ç›´åˆ°çº¿ç¨‹è·å–åˆ°å¯¹è±¡çš„é”ã€‚

æˆ‘ä»¬æ¥æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹

```java
public class BlockedState {
    public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(new DemoThreadB());
        Thread t2 = new Thread(new DemoThreadB());
         
        t1.start();
        t2.start();
         
        Thread.sleep(1000);
         
        Log.info(t2.getState()); //BLOCKED
        System.exit(0);
    }
}
 
class DemoThreadB implements Runnable {
    @Override
    public void run() {
        commonResource();
    }
     
    public static synchronized void commonResource() {
        while(true) {
			//å†™ä¸€ä¸ªæ­»å¾ªç¯
            //æ­¤æ—¶t1ä¸ä¼šè¿”å›ï¼Œt2å› ä¸ºæ²¡é”æ‰€ä»¥å¿…é¡»ç­‰å¾…ï¼Œå› æ­¤t2å¤„äºBLOCKEDçŠ¶æ€
        }
    }
}
```

## Waiting

åœ¨WAITINGçŠ¶æ€ä¸­çš„çº¿ç¨‹ä¼šç­‰å¾…å¦å¤–çš„æŸäº›çº¿ç¨‹æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œå¦‚notify()ã€‚è¿‡ç¨‹æ²¡æœ‰æ—¶é™ã€‚æœ‰ä¸‰ç§æ–¹æ³•èƒ½è®©çº¿ç¨‹å˜æˆWAITINGçŠ¶æ€ï¼š

1. *object.wait()*
2. *thread.join()* 
3. *LockSupport.park()*

è®©çº¿ç¨‹å˜æˆWAITINGçŠ¶æ€çŠ¶æ€çš„ç¤ºä¾‹ç¨‹åºï¼š

```java
public class WaitingState implements Runnable {
    public static Thread t1;
 
    public static void main(String[] args) {
        t1 = new Thread(new WaitingState());
        t1.start();
    }
 
    public void run() {
        Thread t2 = new Thread(new DemoThreadWS());
        t2.start();
 
        try {
            t2.join();	//ç­‰t2çº¿ç¨‹æ‰§è¡Œå®Œå†ç»§ç»­æ‰§è¡Œå½“å‰çº¿ç¨‹
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            Log.error("Thread interrupted", e);
        }
    }
}
 
class DemoThreadWS implements Runnable {
    public void run() {
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            Log.error("Thread interrupted", e);
        }
         
        Log.info(WaitingState.t1.getState());	//t1æ­¤æ—¶åœ¨ç­‰å¾…å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œæ‰€ä»¥è¿™é‡Œè¾“å‡ºWAITING
    }
}
```

## Timed Waiting

Timed WaitingçŠ¶æ€ä¸­ï¼Œå¾…å¦å¤–çš„æŸäº›çº¿ç¨‹åœ¨æŒ‡å®šæ—¶é—´å†…æ‰§è¡Œç‰¹å®šæ“ä½œï¼Œå¦‚notify()ã€‚ä¸‹é¢çš„æ–¹æ³•å¯ä»¥è®©ä¸€ä¸ªçº¿ç¨‹æˆä¸ºTimed WaitingçŠ¶æ€:

1. *thread.sleep(long millis)*
2. *wait(int timeout)* or *wait(int timeout, int nanos)*
3. *thread.join(long* millis*)*
4. *LockSupport.parkNanos*
5. *LockSupport.parkUntil*

ç¤ºä¾‹ç¨‹åºï¼š

```java
public class TimedWaitingState {
    public static void main(String[] args) throws InterruptedException {
        DemoThread obj1 = new DemoThread();
        Thread t1 = new Thread(obj1);
        t1.start();
         
        // The following sleep will give enough time for ThreadScheduler
        // to start processing of thread t1
        Thread.sleep(1000);
        Log.info(t1.getState());	//æ­¤æ—¶t1åœ¨ç­‰å¾…5ç§’è¿‡å»ï¼Œæ‰€ä»¥è¿™é‡Œè¾“å‡ºTIMED_WAITING
    }
}
 
class DemoThread implements Runnable {
    @Override
    public void run() {
        try {
            Thread.sleep(5000);		//ç­‰å¾…5ç§’
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            Log.error("Thread interrupted", e);
        }
    }
}
```

## Terminated

å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä»–ä¼šå˜ä¸ºTERMINATEDçŠ¶æ€ã€‚

ç¤ºä¾‹ç¨‹åºï¼š

```java
ublic class TerminatedState implements Runnable {
    public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(new TerminatedState());
        t1.start();
        // ç­‰1ç§’é’Ÿï¼Œè®©çº¿ç¨‹è°ƒåº¦å™¨èƒ½è°ƒåº¦t1
        Thread.sleep(1000);
        Log.info(t1.getState());	//TERMINATED
    }
     
    @Override
    public void run() {
        // ä»€ä¹ˆéƒ½ä¸åš
    }
}
```

# Reference

[Life Cycle of a Thread in Java](http://www.baeldung.com/java-thread-lifecycle)

[çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåŠäº”ç§åŸºæœ¬çŠ¶æ€](https://blog.csdn.net/houbin0912/article/details/77969563)