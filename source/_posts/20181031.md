---
title: å¹¶å‘æ“ä½œåˆé›†-2.çŠ¶æ€è½¬æ¢æ–¹æ³•ï¼šwait,notify,sleep,join,yield
tags:
  - Java
  - å¹¶å‘
  - å¹¶å‘æ“ä½œåˆé›†
categories:
  - å¹¶å‘æ“ä½œåˆé›†
typora-copy-images-to: 20181031
date: 2018-11-01 21:52:12
---

>  [ğŸ• å¹¶å‘æ“ä½œåˆé›†ç³»åˆ— æºä»£ç ](https://github.com/nnkwrik/learn-java-concurrency)

è¿™ç¯‡æ–‡ç« ä¸­ä¼šè¯¦ç»†ä»‹ç»é‚£äº›åˆ‡æ¢çº¿ç¨‹çŠ¶æ€çš„å¸¸ç”¨æ–¹æ³•(wait,notify,sleep,join,yield)ã€‚

# çº¿ç¨‹çš„çŠ¶æ€å’Œå¸¸ç”¨æ–¹æ³•

è¿˜æ˜¯è¿™å¼ å›¾ã€‚æœ¬ç« ä¸­ä»‹ç»çš„æ–¹æ³•ä¸çº¿ç¨‹çŠ¶æ€çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤º

![1541035245337](20181031/1541035245337.png)

# wait() å’Œ notify() æ–¹æ³•

é¦–å…ˆï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯åšä»€ä¹ˆçš„ï¼š

- *Object.wait()* â€“ æŒ‚èµ·ä¸€ä¸ªçº¿ç¨‹
- *Object.notify() â€“* å”¤é†’ä¸€ä¸ªçº¿ç¨‹

wait()ä½¿å½“å‰çº¿ç¨‹é˜»å¡ï¼Œå‰ææ˜¯ å¿…é¡»å…ˆè·å¾—é”ï¼Œæ‰€ä»¥é€šå¸¸åœ¨synchronized åŒæ­¥ä»£ç å—é‡Œä½¿ç”¨ wait()ï¼Œnotify/notifyAll() æ–¹æ³•ã€‚

å½“çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•æ—¶å€™ï¼Œä¼šé‡Šæ”¾å½“å‰çš„é”ï¼Œç„¶åè®©å‡ºCPUï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚æ­¤æ—¶çš„ç­‰å¾…çŠ¶æ€å’Œsleepé€ æˆçš„ç­‰å¾…çŠ¶æ€ç¨æœ‰ä¸åŒï¼Œä¸‹ä¸€ç« ä¼šå¯¹æ­¤è¿›è¡Œè§£é‡Šã€‚

å½“ notify/notifyAll() è¢«æ‰§è¡Œæ—¶å€™ï¼Œæ‰ä¼šå”¤é†’ä¸€ä¸ªæˆ–å¤šä¸ªæ­£å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œç„¶åç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°æ‰§è¡Œå®Œsynchronized ä»£ç å—çš„ä»£ç ã€‚å¦‚æœä¸­é€”é‡åˆ°wait() ï¼Œå°†å†æ¬¡é‡Šæ”¾é”ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œnotify/notifyAll() çš„æ‰§è¡Œåªæ˜¯å”¤é†’æ²‰ç¡çš„çº¿ç¨‹ï¼Œè€Œä¸ä¼šç«‹å³é‡Šæ”¾é”ï¼Œ**æ­¤æ—¶è¢«å”¤é†’çš„ç­‰å¾…çº¿çŠ¶æ€çš„çº¿ç¨‹å°†ä¼šå˜ä¸ºé˜»å¡çŠ¶æ€ï¼ˆBLOCKEDï¼‰ä½äºå¯¹è±¡çš„ç­‰å¾…é”å®šæ± ï¼Œç›´åˆ°notifyé‡Šæ”¾é”å¹¶è·å–è¯¥é”**ã€‚æ‰€ä»¥åœ¨ç¼–ç¨‹ä¸­ï¼Œå°½é‡åœ¨ä½¿ç”¨äº†notify/notifyAll() åç«‹å³é€€å‡ºä¸´ç•ŒåŒºï¼Œä»¥å”¤é†’å…¶ä»–çº¿ç¨‹ ã€‚

å¦å¤–wait() éœ€è¦è¢«try catchåŒ…å›´ï¼Œä¸­æ–­ä¹Ÿå¯ä»¥ä½¿waitç­‰å¾…çš„çº¿ç¨‹å”¤é†’ã€‚

notify å’Œ notifyAllçš„åŒºåˆ« ï¼š notifyæ–¹æ³•åªå”¤é†’ä¸€ä¸ªç­‰å¾…ï¼ˆå¯¹è±¡çš„ï¼‰çº¿ç¨‹å¹¶ä½¿è¯¥çº¿ç¨‹å¼€å§‹æ‰§è¡Œã€‚æ‰€ä»¥å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ç­‰å¾…ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•åªä¼šå”¤é†’å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ï¼Œé€‰æ‹©å“ªä¸ªçº¿ç¨‹å–å†³äºæ“ä½œç³»ç»Ÿå¯¹å¤šçº¿ç¨‹ç®¡ç†çš„å®ç°ã€‚notifyAll ä¼šå”¤é†’æ‰€æœ‰ç­‰å¾…(å¯¹è±¡çš„)çº¿ç¨‹ï¼Œå°½ç®¡å“ªä¸€ä¸ªçº¿ç¨‹å°†ä¼šç¬¬ä¸€ä¸ªå¤„ç†å–å†³äºæ“ä½œç³»ç»Ÿçš„å®ç°ã€‚å¦‚æœå½“å‰æƒ…å†µä¸‹æœ‰å¤šä¸ªçº¿ç¨‹éœ€è¦è¢«å”¤é†’ï¼Œæ¨èä½¿ç”¨notifyAll æ–¹æ³•ã€‚

## ç¤ºä¾‹ï¼šå‘é€è€… - æ¥æ”¶è€…åŒæ­¥é—®é¢˜

å‡å¦‚æœ‰è¿™æ ·çš„éœ€æ±‚ï¼š

- å‘é€è€…ä¼šå‘æ¥æ”¶è€…å‘é€æ•°æ®åŒ…
- åœ¨å‘é€è€…å®Œæˆå‘é€ä¹‹å‰ï¼Œæ¥æ”¶è€…æ— æ³•å¤„ç†æ•°æ®åŒ…
- åŒæ ·ï¼Œå‘é€è€…ä¸å¾—å°è¯•å‘é€å¦ä¸€ä¸ªæ•°æ®åŒ…ï¼Œç›´åˆ°æ¥æ”¶è€…å·²å¤„ç†å®Œä¸Šä¸€ä¸ªæ•°æ®åŒ…

åˆ›å»ºä¸€ä¸ªDataç±»æ¥å®ç°è¿™äº›æ•°æ®åŒ…çš„æ“ä½œ

```java
public class Data {
    private String packet;
     
    // True if receiver should wait
    // False if sender should wait
    private boolean transfer = true;
  
    public synchronized void send(String packet) {
        while (!transfer) {
            try { 
                wait();
            } catch (InterruptedException e)  {
                Thread.currentThread().interrupt(); 
                Log.error("Thread interrupted", e); 
            }
        }
        transfer = false;
         
        this.packet = packet;
        notifyAll();
    }
  
    public synchronized String receive() {
        while (transfer) {
            try {
                wait();
            } catch (InterruptedException e)  {
                Thread.currentThread().interrupt(); 
                Log.error("Thread interrupted", e); 
            }
        }
        transfer = true;
 
        notifyAll();
        return packet;
    }
}
```



é‚£ä¹ˆä¸ºä»€ä¹ˆè¦ç”¨whileè€Œä¸æ˜¯ifåŒ…ä½wait()ï¼Ÿ

å› ä¸ºè¿™é‡Œçš„notifyAll()å”¤é†’çš„æ˜¯æ‰€æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´è¢«å”¤é†’çš„çº¿ç¨‹å¯èƒ½å¹¶ä¸ç¬¦åˆæ¡ä»¶åˆ¤æ–­ï¼Œæ‰€ä»¥åº”è¯¥ç”¨whileå¾ªç¯å†æ¬¡è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸æ»¡è¶³å°†ç»§ç»­è°ƒç”¨waitã€‚

ä¸‹é¢æ˜¯Senderç±»å’ŒReceiverç±»ï¼Œå®ƒä»¬å°†å¯¹Dataç±»è¿›è¡ŒåŒæ­¥æ“ä½œï¼š

Sender:

```java
public class Sender implements Runnable {
    private Data data;
  
    // standard constructors
  
    public void run() {
        String packets[] = {
          "First packet",
          "Second packet",
          "Third packet",
          "Fourth packet",
          "End"
        };
  
        for (String packet : packets) {
            data.send(packet);
 
            // Thread.sleep() to mimic heavy server-side processing
            try {
                Thread.sleep(ThreadLocalRandom.current().nextInt(1000, 5000));
            } catch (InterruptedException e)  {
                Thread.currentThread().interrupt(); 
                Log.error("Thread interrupted", e); 
            }
        }
    }
}

```

Receiver:

```java
public class Receiver implements Runnable {
    private Data load;
  
    // standard constructors
  
    public void run() {
        for(String receivedMessage = load.receive();
          !"End".equals(receivedMessage);
          receivedMessage = load.receive()) {
             
            System.out.println(receivedMessage);
 
            // ...
            try {
                Thread.sleep(ThreadLocalRandom.current().nextInt(1000, 5000));
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt(); 
                Log.error("Thread interrupted", e); 
            }
        }
    }
}
```

å†™ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºæ¥å¯åŠ¨Senderå’ŒReceiver

```java
public static void main(String[] args) {
    Data data = new Data();
    Thread sender = new Thread(new Sender(data));
    Thread receiver = new Thread(new Receiver(data));
     
    sender.start();
    receiver.start();
}
-------------------------------------------------
è¾“å‡ºï¼š
First packet
Second packet
Third packet
Fourth packet
```

# wait()å’Œsleep()æ–¹æ³•

æˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“è¯¥æ–¹æ³•æ˜¯å±äºThreadç±»ä¸­çš„ã€‚è€Œwait()æ–¹æ³•ï¼Œåˆ™æ˜¯å±äºObjectç±»ä¸­çš„ã€‚

sleep()æ–¹æ³•å¯¼è‡´äº†ç¨‹åºæš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œè®©å‡ºcpuè¯¥å…¶ä»–çº¿ç¨‹ï¼Œä½†æ˜¯ä»–çš„ç›‘æ§çŠ¶æ€ä¾ç„¶ä¿æŒç€ï¼Œå½“æŒ‡å®šçš„æ—¶é—´åˆ°äº†åˆä¼šè‡ªåŠ¨æ¢å¤è¿è¡ŒçŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è°ƒç”¨sleep()æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ã€‚

è€Œå½“è°ƒç”¨wait()æ–¹æ³•çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šæ”¾å¼ƒå¯¹è±¡é”ï¼Œè¿›å…¥ç­‰å¾…æ­¤å¯¹è±¡çš„ç­‰å¾…é”å®šæ± ï¼Œåªæœ‰é’ˆå¯¹æ­¤å¯¹è±¡è°ƒç”¨notify()æ–¹æ³•åæœ¬çº¿ç¨‹æ‰è¿›å…¥å¯¹è±¡é”å®šæ± å‡†å¤‡è·å–å¯¹è±¡é”è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚

## ç¤ºä¾‹ä»£ç 

```java
public class Test {

    public static void main(String[] args) throws InterruptedException {
        
        //æµ‹è¯•Waitä¼šé‡Šæ”¾é”
        new Thread(new WaitTread()).start();
        Thread.sleep(1000);
        new Thread(new SleepThread()).start();

		//æµ‹è¯•sleepä¸ä¼šé‡Šæ”¾é”
//        new Thread(new SleepThread()).start();
//        Thread.sleep(1000);
//        new Thread(new WaitTread()).start();

    }
}

class WaitTread implements Runnable {

    @Override
    public void run() {
        synchronized (Test.class) {
            System.out.println("è¿›å…¥WaitTread å½“å‰æ—¶é—´ ï¼š " + LocalTime.now());
            //è°ƒç”¨wait()æ–¹æ³•ï¼Œçº¿ç¨‹ä¼šæ”¾å¼ƒå¯¹è±¡é”ï¼Œè¿›å…¥ç­‰å¾…æ­¤å¯¹è±¡çš„ç­‰å¾…é”å®šæ± 
            try {
                Test.class.wait(5000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }

            System.out.println("WaitTreadç»“æŸäº† å½“å‰æ—¶é—´ ï¼š " + LocalTime.now());
        }
    }
}

class SleepThread implements Runnable {

    @Override
    public void run() {
        synchronized (Test.class) {
            System.out.println("è¿›å…¥SleepThread å½“å‰æ—¶é—´ ï¼š " + LocalTime.now());


            //åœ¨è°ƒç”¨sleep()æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ã€‚
            try {
                Thread.sleep(5000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println("SleepThreadç»“æŸäº† å½“å‰æ—¶é—´ ï¼š " + LocalTime.now());
        }
    }
}
```

ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œsleepå’Œwaitä¼šåˆ†åˆ«æš‚åœ5ç§’ï¼Œçº¿ç¨‹å¯åŠ¨ä¹‹é—´é—´éš”1ç§’ã€‚

ä¿®æ”¹WaitTreadå’ŒSleepThreadçš„å¯åŠ¨é¡ºåºï¼Œè¾“å‡ºç»“æœä¼šæˆªç„¶ä¸åŒï¼š

```java
        //æµ‹è¯•sleepä¸ä¼šé‡Šæ”¾é”
        new Thread(new SleepThread()).start();
        Thread.sleep(1000);
        new Thread(new WaitTread()).start();
-------------------------------------------------
è¾“å‡º
è¿›å…¥SleepThread å½“å‰æ—¶é—´ ï¼š 21:59:49.747
SleepThreadç»“æŸäº† å½“å‰æ—¶é—´ ï¼š 21:59:54.747
è¿›å…¥WaitTread å½“å‰æ—¶é—´ ï¼š 21:59:54.748
WaitTreadç»“æŸäº† å½“å‰æ—¶é—´ ï¼š 21:59:59.748
```

å¾ˆæ˜¾ç„¶ï¼Œç”±äºsleepä¸é‡Šæ”¾é”ï¼Œæ‰€ä»¥ç›´åˆ°sleepçº¿ç¨‹æ‰§è¡Œç»“æŸåwaitçº¿ç¨‹æ‰è·å–åˆ°é”ã€‚waitçº¿ç¨‹åœ¨è¢«å¯åŠ¨çš„4ç§’åæ‰å¼€å§‹æ‰§è¡Œã€‚

å¦‚æœæŠŠè°ƒç”¨é¡ºåºåè¿‡æ¥ä¼šå¦‚ä½•ï¼š

```java
        //æµ‹è¯•waitä¼šé‡Šæ”¾é”
        new Thread(new WaitTread()).start();
        Thread.sleep(1000);
        new Thread(new SleepThread()).start();
-------------------------------------------------
è¾“å‡º
è¿›å…¥WaitTread å½“å‰æ—¶é—´ ï¼š 21:53:56.563
è¿›å…¥SleepThread å½“å‰æ—¶é—´ ï¼š 21:53:57.492
SleepThreadç»“æŸäº† å½“å‰æ—¶é—´ ï¼š 21:54:02.492
WaitTreadç»“æŸäº† å½“å‰æ—¶é—´ ï¼š 21:54:02.493
```

åœ¨WaitTreadè°ƒç”¨wait()ä¹‹åSleepThreadè·å–åˆ°äº†é”ï¼Œè¯´æ˜waitè¿‡ç¨‹ä¸­ä¼šé‡Šæ”¾é”ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒWaitTreadä»å¼€å§‹åˆ°ç»“æŸèŠ±äº†æ•´æ•´6ç§’æ—¶é—´ï¼Œè€Œæˆ‘ä»¬è®¾ç½®çš„waitçš„æ—¶é™æ˜¯5ç§’ï¼Œæ˜¯å’ŒSleepThreadå‡ ä¹åŒæ—¶ç»“æŸçš„ã€‚åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œwaitç»è¿‡5ç§’åå”¤é†’ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹å¤„äºç­‰å¾…é”å®šæ± ï¼Œè€Œæ­¤æ—¶çš„é”è¿˜åœ¨sleepçº¿ç¨‹æ‰‹ä¸­ï¼Œå› æ­¤ç›´åˆ°sleepçº¿ç¨‹æ‰§è¡Œå®Œæ¯•é‡Šæ”¾é”ä¹‹åï¼Œwaitçº¿ç¨‹æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚

# join()æ–¹æ³•

## join()æ–¹æ³•çš„ä½œç”¨

thread.joinæŠŠæŒ‡å®šçš„çº¿ç¨‹åŠ å…¥åˆ°å½“å‰çº¿ç¨‹ï¼Œå¯ä»¥å°†ä¸¤ä¸ªäº¤æ›¿æ‰§è¡Œçš„çº¿ç¨‹åˆå¹¶ä¸ºé¡ºåºæ‰§è¡Œçš„çº¿ç¨‹ã€‚æ¯”å¦‚åœ¨çº¿ç¨‹Bä¸­è°ƒç”¨äº†çº¿ç¨‹Açš„Join()æ–¹æ³•ï¼Œç›´åˆ°çº¿ç¨‹Aæ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œçº¿ç¨‹Bã€‚

å®ƒçš„é‡è½½ï¼š

- t.join() ï¼š è°ƒç”¨joinæ–¹æ³•ï¼Œç­‰å¾…çº¿ç¨‹tæ‰§è¡Œå®Œæ¯•
- t.join(1000) ï¼š ç­‰å¾… t çº¿ç¨‹ï¼Œç­‰å¾…æ—¶é—´æ˜¯1000æ¯«ç§’ã€‚

## ä½¿ç”¨joinæ—¶éœ€è¦æ³¨æ„çš„å‡ ç‚¹

è°ƒç”¨joinæ—¶éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

- **åªèƒ½ç”¨äºå·²å¯åŠ¨çš„çº¿ç¨‹**
  å¦‚æœçº¿ç¨‹è¢«ç”Ÿæˆäº†ï¼Œä½†è¿˜æœªè¢«èµ·åŠ¨ï¼Œè°ƒç”¨å®ƒçš„ join() æ–¹æ³•æ˜¯æ²¡æœ‰ä½œç”¨çš„ï¼Œå°†ç›´æ¥ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚åœ¨æºç ä¸­ç”¨isAlive()æ¥è¿›è¡Œåˆ¤æ–­ã€‚
- **joinæ˜¯åŸºäºwaitå®ç°çš„**
  é€šè¿‡wait(timeout)æ¥è®©å½“å‰çº¿ç¨‹å˜ä¸ºç­‰å¾…çŠ¶æ€ï¼Œè¿™é‡Œçš„timeoutæ˜¯ç›®æ ‡çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ã€‚ä»è€Œå®ç°è®©å½“å‰çº¿ç¨‹æˆä¸ºç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚
- **è°ƒç”¨joinæ—¶ï¼Œå¿…é¡»å…ˆè·å–ç›®æ ‡çº¿ç¨‹çš„é”**
  æ—¢ç„¶åŸºäºwaitï¼Œé‚£ä¹ˆjoinæ–¹æ³•è‚¯å®šæ˜¯åœ¨synchronizedä¸­ï¼Œè¿™æ˜¯å› ä¸ºwaitå¿…é¡»æ˜¯åœ¨æœ‰é”çš„åœ°æ–¹æ‰èƒ½ä½¿ç”¨ã€‚ä»æºç ä¸Šæ¥çœ‹ä¹Ÿç¡®å®å¦‚æ­¤ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨è°ƒç”¨joinæ—¶æˆ‘ä»¬å¿…é¡»è·å¾—ç›®æ ‡çº¿ç¨‹tçš„é”ï¼Œå¦åˆ™ä¼šä¸€ç›´è¢«é˜»å¡ã€‚

è¯¦ç»†å¯ä»¥å‚è€ƒJDKæºç ï¼š

```java
public final synchronized void join(long millis) throws InterruptedException {
    long base = System.currentTimeMillis();
    long now = 0;

    if (millis < 0) {
        throw new IllegalArgumentException("timeout value is negative");
    }

    if (millis == 0) {
        while (isAlive()) {
            wait(0);
        }
    } else {
        while (isAlive()) {
            long delay = millis - now;
            if (delay <= 0) {
                break;
            }
            wait(delay);
            now = System.currentTimeMillis() - base;
        }
    }
}
```

## ç¤ºä¾‹ä»£ç 

ä¸ºäº†ç†è§£joinï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªç¤ºä¾‹

```java
public class TestJoin implements Runnable {

    public static void main(String[] args) throws InterruptedException {
        Thread t = new Thread(new TestJoin());
        long start = System.currentTimeMillis();
        t.start();
        Thread.sleep(1000);	//ä¸ºäº†è®©çº¿ç¨‹è°ƒåº¦å™¨èƒ½è°ƒåº¦åˆ°t
        t.join(2000);
        System.out.println("t.join()è°ƒç”¨ç»“æŸï¼Œè€—æ—¶(ms)ï¼š" + (System.currentTimeMillis() - start));
        System.out.println(" Main ç»“æŸäº†");
    }

    @Override
    public void run() {
        for (int i = 0; i < 5; i++) {
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println("sleeping" + i);
        }

        System.out.println("TestJoin ç»“æŸäº†");
    }
}
-----------------------------------------------------
è¾“å‡º
sleeping0
sleeping1
t.join()è°ƒç”¨ç»“æŸï¼Œè€—æ—¶(ms)ï¼š3000
Main ç»“æŸäº†
sleeping2
sleeping3
sleeping4
TestJoin ç»“æŸäº†
```

å¯ä»¥çœ‹å‡ºmiançº¿ç¨‹åœ¨è°ƒç”¨join(ï¼‰åå˜ä¸ºç­‰å¾…çŠ¶æ€ï¼Œè®©ç»™çº¿ç¨‹ä¸¤ç§’åç»§ç»­æ‰§è¡Œmainçº¿ç¨‹ã€‚

å¦‚æœä¸å¯åŠ¨çº¿ç¨‹å‘¢ï¼ŸæŠŠstart()æ³¨é‡Šæ‰

```java
//        t.start();
		Thread.sleep(1000);
        t.join(2000);
-------------------------------------------------------
è¾“å‡º
t.join()è°ƒç”¨ç»“æŸï¼Œè€—æ—¶(ms)ï¼š1000
Main ç»“æŸäº†
```

æœç„¶joinæ˜¯ä¸èµ·ä½œç”¨çš„ã€‚

æˆ‘ä»¬å†é€šè¿‡synchronizedå—è®©Mainçº¿ç¨‹è·å–ä¸åˆ°é”ï¼Œä»è€Œæµ‹è¯•"è°ƒç”¨joinæ—¶ï¼Œå¿…é¡»å…ˆè·å–ç›®æ ‡çº¿ç¨‹çš„é”"ã€‚

æŠŠrun()æ”¹æˆä»¥ä¸‹ï¼š

```java
    @Override
    public void run() {
        synchronized (Thread.currentThread()) {
            for (int i = 0; i < 5; i++) {
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                System.out.println("sleeping" + i);
            }
            System.out.println("TestJoin ç»“æŸäº†");
        }
    }
-------------------------------------------------------
è¾“å‡º
sleeping0
sleeping1
sleeping2
sleeping3
sleeping4
TestJoin ç»“æŸäº†
t.join()è°ƒç”¨ç»“æŸï¼Œè€—æ—¶(ms)ï¼š5002
Main ç»“æŸäº†
```

mainçº¿ç¨‹å› ä¸ºè·å–ä¸åˆ°é”ï¼Œæ‰€ä»¥ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°çº¿ç¨‹tæ‰§è¡Œå®Œæ¯•ã€‚

# yield()æ–¹æ³•

## yield()çš„ä½œç”¨

yield()åº”è¯¥åšçš„æ˜¯è®©å½“å‰è¿è¡Œçº¿ç¨‹å›åˆ°å¯è¿è¡ŒçŠ¶æ€ï¼Œä»¥å…è®¸å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶ä»–çº¿ç¨‹è·å¾—è¿è¡Œæœºä¼šã€‚å› æ­¤ï¼Œä½¿ç”¨yield()çš„ç›®çš„æ˜¯è®©ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹ä¹‹é—´èƒ½é€‚å½“çš„è½®è½¬æ‰§è¡Œã€‚

ä½†æ˜¯ï¼Œå®é™…ä¸­æ— æ³•ä¿è¯yield()è¾¾åˆ°è®©æ­¥ç›®çš„ï¼Œå› ä¸ºè®©æ­¥çš„çº¿ç¨‹è¿˜æœ‰å¯èƒ½è¢«çº¿ç¨‹è°ƒåº¦ç¨‹åºå†æ¬¡é€‰ä¸­ã€‚yield()åº”è¯¥åšçš„æ˜¯è®©å½“å‰è¿è¡Œçº¿ç¨‹å›åˆ°å¯è¿è¡ŒçŠ¶æ€ï¼Œä»¥å…è®¸å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶ä»–çº¿ç¨‹è·å¾—è¿è¡Œæœºä¼šã€‚æ‰€ä»¥ï¼Œä½¿ç”¨yield()çš„ç›®çš„æ˜¯è®©ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹ä¹‹é—´èƒ½é€‚å½“çš„è½®è½¬æ‰§è¡Œã€‚

ä½†æ˜¯ï¼Œå®é™…ä¸­æ— æ³•ä¿è¯yield()è¾¾åˆ°è®©æ­¥ç›®çš„ï¼Œå› ä¸ºè®©æ­¥çš„çº¿ç¨‹è¿˜æœ‰å¯èƒ½è¢«çº¿ç¨‹è°ƒåº¦ç¨‹åºå†æ¬¡é€‰ä¸­ã€‚yield()çš„ä½¿ç”¨åœºæ™¯å¾ˆå°‘ï¼Œå¦‚æœä¸æ˜¯æœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œå°½é‡é¿å…ä½¿ç”¨ã€‚

## ç¤ºä¾‹ä»£ç 

```java
public class ThreadYield {
    public static void main(String[] args) {
        Runnable r = () -> {
            int counter = 0;
            while (counter < 2) {
                System.out.println(Thread.currentThread().getName());
                counter++;
                Thread.yield();
            }
        };

        new Thread(r).start();
        new Thread(r).start();
    }
}
```

è¿è¡Œç»“æœå¯èƒ½æ˜¯

```java
Thread-0
Thread-1
Thread-1
Thread-0
```

ä¹Ÿå¯èƒ½æ˜¯

```
Thread-0
Thread-0
Thread-1
Thread-1
```

# Reference

[Javaå¤šçº¿ç¨‹å­¦ä¹ ä¹‹waitã€notify/notifyAll è¯¦è§£](https://www.cnblogs.com/moongeek/p/7631447.html)

[wait and notify() Methods in Java](http://www.baeldung.com/java-wait-notify)

[javaä¸­çš„sleep()å’Œwait()çš„åŒºåˆ«](https://www.cnblogs.com/hongten/p/hongten_java_sleep_wait.html)

[Difference Between Wait and Sleep in Java](http://www.baeldung.com/java-wait-and-sleep)

[Javaä¸­join()æ–¹æ³•çš„ç†è§£](https://www.cnblogs.com/aboutblank/p/3631453.html)

[javaä¸­yield()æ–¹æ³•å¦‚ä½•ä½¿ç”¨](https://blog.csdn.net/zhuwei898321/article/details/72844506)

[Brief Introduction to Java Thread.yield()](https://www.baeldung.com/java-thread-yield)

